#!/bin/zsh

# Use first argument as remote URL, second as optional branch, third as optional commit message
REMOTE_URL=${1}
BRANCH_NAME=${2:-"main"}
COMMIT_MESSAGE=${3:-"Initial commit"}

if [ -z "$REMOTE_URL" ]; then
  echo "No remote URL provided. Please provide a remote URL as the first argument."
  exit 1
fi

# Initialize a new Git repository
git init  # safe even if repo already exists
git add .
git commit -m "$COMMIT_MESSAGE"
git branch -M "$BRANCH_NAME"

# add or update the origin remote
if git remote | grep -q "^origin$"; then
  git remote set-url origin "$REMOTE_URL"
else
  git remote add origin "$REMOTE_URL"
fi

git push -u origin main
echo "Git repository initialized with message \"$COMMIT_MESSAGE\" "$(printf '\e]8;;%s\a%s\e]8;;\a' "$REMOTE_URL" "Click here to view")